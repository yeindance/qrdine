# env used here need to pass  via `docker compose --env-file=`
services:
  # -------------- nestjs --------------
  central-api:
    container_name: central-api

    build:
      context: ./apps/central-api
      dockerfile: Dockerfile

    env_file:
      - ./apps/central-api/.env # runtime env

    ports:
      - '${CENTRAL_API_PORT}:${CENTRAL_API_PORT}'

    volumes:
      - ./apps/central-api:/usr/src/app
      - /usr/src/app/node_modules

    depends_on:
      - postgres-db

  # -------------- postgres --------------
  postgres-db:
    container_name: postgres-db
    image: postgres
    # restart: always

    ports:
      - ${CENTRAL_API_DB_POSTGRES_PORT}:${CENTRAL_API_DB_POSTGRES_PORT}

    environment:
      POSTGRES_USER: '${CENTRAL_API_DB_POSTGRES_USER}'
      POSTGRES_PASSWORD: '${CENTRAL_API_DB_POSTGRES_PWD}'
      POSTGRES_DB: '${CENTRAL_API_DB_POSTGRES_NAME}'
